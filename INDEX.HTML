<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PULSE 3 VAULT</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --bg: #050505; 
            --surface: #121212; 
            --lime: #CCFF00; 
            --gold: #D4AF37; 
            --glass: rgba(255, 255, 255, 0.05); 
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg); 
            color: white; 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            -webkit-tap-highlight-color: transparent;
        }
        
        /* --- AGE GATE --- */
        #ageGate { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; align-items: center; justify-content: center; text-align: center; }
        .age-box { border: 1px solid var(--lime); padding: 40px 20px; border-radius: 30px; background: var(--surface); width: 85%; box-shadow: 0 0 30px rgba(204, 255, 0, 0.1); }
        
        /* --- LAYOUT --- */
        .container { padding: 20px; display: none; height: 100vh; overflow-y: auto; box-sizing: border-box; }
        header { text-align: center; padding: 15px 0; border-bottom: 1px solid var(--glass); }
        h1 { font-family: 'Montserrat'; font-size: 24px; color: var(--gold); letter-spacing: 3px; margin: 0; }
        .user-id { font-size: 10px; color: #555; margin-top: 5px; letter-spacing: 1px; }

        /* --- STATS --- */
        .stats-bar { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-card { background: var(--surface); border: 1px solid var(--glass); padding: 15px; border-radius: 18px; text-align: center; }
        .stat-val { font-family: 'Montserrat'; font-size: 18px; display: block; margin-top: 4px; color: white; }
        .label { color: var(--lime); font-size: 9px; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }

        /* --- ITEM LIST --- */
        .section-title { color: var(--lime); font-size: 11px; font-weight: bold; margin-bottom: 15px; text-transform: uppercase; display: flex; align-items: center; gap: 8px; }
        .section-title::before { content: ''; display: block; width: 3px; height: 15px; background: var(--lime); }
        
        .item-list { display: flex; flex-direction: column; gap: 12px; padding-bottom: 120px; }
        .item-row { background: var(--surface); padding: 12px; border-radius: 24px; display: flex; align-items: center; justify-content: space-between; border: 1px solid var(--glass); }
        .item-info { display: flex; align-items: center; gap: 15px; }
        
        /* Tiny Circles */
        .circle-img { width: 52px; height: 52px; border-radius: 50%; border: 2px solid var(--lime); object-fit: cover; background: #1a1a1a; flex-shrink: 0; }
        
        .name-stack b { display: block; font-size: 14px; font-family: 'Montserrat'; color: #fff; }
        .name-stack span { font-size: 10px; color: var(--lime); opacity: 0.7; font-weight: 600; }

        .bet-btn { background: var(--lime); color: black; border: none; padding: 10px 20px; border-radius: 14px; font-weight: 900; font-size: 11px; transition: 0.2s; }
        .bet-btn:active { transform: scale(0.92); opacity: 0.8; }

        /* --- WALLET VIEW --- */
        .view { display: none; animation: slideIn 0.3s ease-out; }
        .view.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .wallet-info-box { background: var(--surface); padding: 25px; border-radius: 25px; border: 1px dashed #333; text-align: left; }
        .topup-btn { width: 100%; padding: 20px; background: var(--lime); color: black; border: none; border-radius: 20px; font-weight: 900; font-size: 15px; margin-top: 25px; box-shadow: 0 10px 20px rgba(204, 255, 0, 0.15); }

        /* --- NAV --- */
        .nav { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); border-top: 1px solid var(--glass); padding-bottom: env(safe-area-inset-bottom); z-index: 500; }
        .nav-btn { flex: 1; padding: 20px; text-align: center; font-size: 11px; color: #444; font-weight: 800; letter-spacing: 1px; }
        .nav-btn.active { color: var(--lime); border-top: 2px solid var(--lime); background: linear-gradient(to bottom, rgba(204, 255, 0, 0.05), transparent); }
    </style>
</head>
<body>

    <div id="ageGate">
        <div class="age-box">
            <h1 style="color:var(--lime); margin-bottom: 10px;">18+ VERIFIED</h1>
            <p style="font-size:13px; color:#aaa; margin-bottom: 25px;">You are entering a secure gaming vault.<br>Confirm your age to sync data.</p>
            <button onclick="confirmAge()" style="background:var(--lime); border:none; padding:18px 50px; border-radius:15px; font-weight:900; font-size:14px;">I AM 18+</button>
        </div>
    </div>

    <div class="container" id="mainApp">
        <header>
            <h1>PULSE 3</h1>
            <div class="user-id" id="userHeader">SYNCING...</div>
        </header>

        <div class="stats-bar">
            <div class="stat-card">
                <span class="label">My Balance</span>
                <span class="stat-val" id="balVal">$0.00</span>
            </div>
            <div class="stat-card">
                <span class="label">Next Draw</span>
                <span class="stat-val" id="timerVal">--:--</span>
            </div>
        </div>

        <div id="vaultView" class="view active">
            <div class="section-title" id="catTitle">CATEGORY: LOADING...</div>
            <div class="item-list" id="itemGrid">
                </div>
        </div>

        <div id="walletView" class="view">
            <div class="wallet-info-box">
                <b style="color:var(--lime); font-size: 16px;">BANK TRANSFER</b>
                <p style="font-size:13px; color:#888; line-height: 1.6; margin-top: 10px;">
                    Send funds to the account below:<br>
                    <span style="color:white; font-family: monospace;">NCB SAVINGS: 123-456-789</span><br>
                    NAME: PULSE 3 MEDIA
                </p>
                <p style="font-size: 11px; color: #555;">*Credits are applied once Admin verifies the receipt.</p>
            </div>
            <button class="topup-btn" onclick="sendTopUp()">REQUEST TOP-UP</button>
        </div>
    </div>

    <nav class="nav">
        <div id="btn-vault" class="nav-btn active" onclick="nav('vaultView', 'btn-vault')">VAULT</div>
        <div id="btn-wallet" class="nav-btn" onclick="nav('walletView', 'btn-wallet')">WALLET</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        function confirmAge() {
            document.getElementById('ageGate').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }

        // --- DYNAMIC DATA SYNC ---
        const urlParams = new URLSearchParams(window.location.search);
        const name = urlParams.get('name') || "User";
        const uid = urlParams.get('uid') || "000";
        const bal = urlParams.get('bal') || "0.00";
        const cat = urlParams.get('cat') || "Luxury";
        const items = (urlParams.get('items') || "Item 1,Item 2,Item 3").split(',');

        document.getElementById('userHeader').innerText = `VAULT ID: ${uid} | ${name.toUpperCase()}`;
        document.getElementById('balVal').innerText = `$${parseFloat(bal).toLocaleString()}`;
        document.getElementById('catTitle').innerText = `CATEGORY: ${cat}`;

        // Luxury Image Library
        const getLuxuryImg = (itemName) => {
            if(itemName.includes("Toyota") || itemName.includes("Hilux")) return "https://images.unsplash.com/photo-1590362891991-f776e747a588?w=150&h=150&fit=crop";
            if(itemName.includes("Rolex")) return "https://images.unsplash.com/photo-1547996160-81dfa63595aa?w=150&h=150&fit=crop";
            if(itemName.includes("Wray") || itemName.includes("Rum")) return "https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?w=150&h=150&fit=crop";
            return `https://api.dicebear.com/7.x/identicon/svg?seed=${itemName}`;
        };

        const grid = document.getElementById('itemGrid');
        items.forEach(item => {
            grid.innerHTML += `
                <div class="item-row">
                    <div class="item-info">
                        <img src="${getLuxuryImg(item)}" class="circle-img">
                        <div class="name-stack">
                            <b>${item}</b>
                            <span>WIN CHANCE: 33.3%</span>
                        </div>
                    </div>
                    <button class="bet-btn" onclick="placeBet('${item}')">BET NOW</button>
                </div>
            `;
        });

        // --- ACTIONS ---
        function placeBet(itemName) {
            tg.HapticFeedback.impactOccurred('heavy');
            tg.sendData(JSON.stringify({ action: "place_bet", item: itemName }));
            tg.close();
        }

        function sendTopUp() {
            tg.HapticFeedback.notificationOccurred('success');
            tg.sendData(JSON.stringify({ action: "top_up_request" }));
            tg.close();
        }

        function nav(viewId, btnId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            document.getElementById(btnId).classList.add('active');
        }

        // --- TIMER SYNC ---
        let timerStr = urlParams.get('time') || "00:00";
        let [m, s] = timerStr.split(':').map(Number);
        setInterval(() => {
            if (s > 0) s--;
            else if (m > 0) { m--; s = 59; }
            document.getElementById('timerVal').innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }, 1000);
    </script>
</body>
</html>
