<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PULSE: THE VAULT</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --bg: #050505; 
            --surface: #121212; 
            --lime: #CCFF00; 
            --gold: #D4AF37; 
            --glass: rgba(255, 255, 255, 0.05); 
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg); 
            color: white; 
            margin: 0; 
            padding: 0; 
            overflow: hidden; 
            -webkit-tap-highlight-color: transparent;
        }
        
        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- LAYOUT --- */
        .container { padding: 20px; height: 100vh; overflow-y: auto; box-sizing: border-box; display: none; animation: fadeIn 0.4s ease-out; }
        header { text-align: center; padding: 15px 0; border-bottom: 1px solid var(--glass); margin-bottom: 20px; }
        h1 { font-family: 'Montserrat'; font-size: 24px; color: var(--gold); letter-spacing: 2px; margin: 0; text-transform: uppercase; text-shadow: 0 0 10px rgba(212, 175, 55, 0.3); }
        .user-id { font-size: 10px; color: #666; margin-top: 5px; letter-spacing: 1px; font-family: monospace; }

        /* --- STATS GRID --- */
        .stats-bar { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
        .stat-card { background: var(--surface); border: 1px solid var(--glass); padding: 15px; border-radius: 16px; text-align: center; position: relative; overflow: hidden; }
        .stat-card::after { content: ''; position: absolute; top: 0; left: 0; width: 3px; height: 100%; background: var(--lime); }
        .stat-val { font-family: 'Montserrat'; font-size: 20px; display: block; margin-top: 5px; color: white; }
        .label { color: var(--lime); font-size: 9px; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }

        /* --- VAULT LIST --- */
        .section-header { display: flex; justify-content: space-between; align-items: end; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 5px; }
        .section-title { color: var(--lime); font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        
        .item-list { display: flex; flex-direction: column; gap: 12px; padding-bottom: 100px; }
        .item-row { 
            background: linear-gradient(145deg, #1a1a1a, #111); 
            padding: 12px; 
            border-radius: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            border: 1px solid var(--glass); 
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transition: transform 0.1s;
        }
        .item-row:active { transform: scale(0.98); }

        .item-info { display: flex; align-items: center; gap: 15px; }
        .circle-img { width: 48px; height: 48px; border-radius: 12px; object-fit: cover; border: 1px solid #333; }
        
        .name-stack b { display: block; font-size: 13px; font-family: 'Montserrat'; color: #fff; margin-bottom: 3px; }
        .name-stack span { font-size: 9px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }

        .bet-btn { background: var(--lime); color: black; border: none; padding: 10px 20px; border-radius: 12px; font-weight: 800; font-size: 11px; letter-spacing: 0.5px; box-shadow: 0 4px 15px rgba(204, 255, 0, 0.2); }

        /* --- AGE GATE --- */
        #ageGate { position: fixed; inset: 0; background: #000; z-index: 999; display: flex; align-items: center; justify-content: center; text-align: center; }
        .gate-content { padding: 40px; border: 1px solid #333; border-radius: 30px; background: #111; width: 80%; }
        
        /* --- WALLET VIEW --- */
        .view { display: none; }
        .view.active { display: block; }
        
        .wallet-box { background: #1a1a1a; padding: 25px; border-radius: 20px; border: 1px dashed #444; margin-top: 20px; }
        .copy-row { background: black; padding: 15px; border-radius: 10px; margin: 15px 0; font-family: monospace; display: flex; justify-content: space-between; font-size: 12px; color: var(--lime); }

        /* --- NAV --- */
        .nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(20,20,20,0.95); backdrop-filter: blur(10px); padding: 5px; border-radius: 40px; display: flex; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 100; }
        .nav-btn { padding: 12px 25px; border-radius: 30px; color: #666; font-size: 11px; font-weight: 800; transition: 0.2s; }
        .nav-btn.active { background: var(--lime); color: black; }

    </style>
</head>
<body>

    <div id="ageGate">
        <div class="gate-content">
            <h1 style="color:var(--lime); margin-bottom:10px;">18+ ONLY</h1>
            <p style="color:#888; font-size:12px; margin-bottom:30px;">By entering Pulse: The Vault, you confirm you are of legal age.</p>
            <button onclick="enterApp()" class="bet-btn" style="width:100%; padding:15px; font-size:14px;">ENTER VAULT</button>
        </div>
    </div>

    <div class="container" id="mainApp">
        <header>
            <h1>PULSE : THE VAULT</h1>
            <div class="user-id" id="userHeader">ID: LOADING...</div>
        </header>

        <div class="stats-bar">
            <div class="stat-card">
                <span class="label">Balance</span>
                <span class="stat-val" id="balVal">$0.00</span>
            </div>
            <div class="stat-card">
                <span class="label">Next Draw</span>
                <span class="stat-val" id="timerVal">--:--</span>
            </div>
        </div>

        <div id="vaultView" class="view active">
            <div class="section-header">
                <span class="section-title" id="catTitle">LOADING...</span>
                <span style="font-size:9px; color:#666;">LIVE ROUND</span>
            </div>
            <div class="item-list" id="itemGrid"></div>
        </div>

        <div id="walletView" class="view">
            <div class="wallet-box">
                <b style="color:white; font-size:14px;">DEPOSIT VIA BANK</b>
                <p style="font-size:11px; color:#888; margin-top:5px;">Transfer funds to the account below and upload your receipt in the chat.</p>
                
                <div class="copy-row" onclick="copyBank()">
                    <span>NCB: 123-456-789</span>
                    <span>ðŸ“‹</span>
                </div>
                
                <button class="bet-btn" style="width:100%; margin-top:10px;" onclick="requestTopUp()">UPLOAD RECEIPT</button>
            </div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-btn active" id="btn-vault" onclick="nav('vaultView', 'btn-vault')">VAULT</div>
        <div class="nav-btn" id="btn-wallet" onclick="nav('walletView', 'btn-wallet')">WALLET</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        function enterApp() {
            document.getElementById('ageGate').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }

        // --- URL PARAMS & SYNC ---
        const params = new URLSearchParams(window.location.search);
        const uid = params.get('uid') || "000";
        const name = params.get('name') || "Guest";
        const bal = parseFloat(params.get('bal') || "0").toLocaleString('en-US', {minimumFractionDigits: 2});
        const cat = params.get('cat') || "FEATURED";
        const items = (params.get('items') || "").split(',');
        const timerStart = params.get('time') || "20:00";

        // SET HEADER INFO
        document.getElementById('userHeader').innerText = `ID: ${uid} | ${name.toUpperCase()}`;
        document.getElementById('balVal').innerText = `$${bal}`;
        document.getElementById('catTitle').innerText = cat;

        // --- SMART IMAGE MATCHING ---
        const getImg = (name) => {
            const n = name.toLowerCase();
            // Cars
            if(n.includes('toyota') || n.includes('honda') || n.includes('benz') || n.includes('bmw') || n.includes('porsche')) return 'https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2?w=150&h=150&fit=crop';
            // Real Estate
            if(n.includes('villa') || n.includes('house') || n.includes('loft') || n.includes('apt')) return 'https://images.unsplash.com/photo-1600596542815-e3289cab6558?w=150&h=150&fit=crop';
            // Tech
            if(n.includes('iphone') || n.includes('ps5') || n.includes('mac') || n.includes('sony')) return 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=150&h=150&fit=crop';
            // Watches
            if(n.includes('rolex') || n.includes('patek') || n.includes('ap') || n.includes('watch')) return 'https://images.unsplash.com/photo-1523170335258-f5ed11844a49?w=150&h=150&fit=crop';
            // Liquor
            if(n.includes('rum') || n.includes('vodka') || n.includes('hennessy') || n.includes('magnum')) return 'https://images.unsplash.com/photo-1566922513-568a86e9d727?w=150&h=150&fit=crop';
            // Default
            return `https://api.dicebear.com/7.x/identicon/svg?seed=${name}`;
        }

        // POPULATE LIST
        const grid = document.getElementById('itemGrid');
        items.forEach(item => {
            if(item.length < 2) return;
            grid.innerHTML += `
            <div class="item-row">
                <div class="item-info">
                    <img src="${getImg(item)}" class="circle-img">
                    <div class="name-stack">
                        <b>${item}</b>
                        <span>WIN 3X PAYOUT</span>
                    </div>
                </div>
                <button class="bet-btn" onclick="placeBet('${item}')">BET</button>
            </div>`;
        });

        // --- INTERACTION ---
        function placeBet(item) {
            tg.HapticFeedback.impactOccurred('medium');
            tg.sendData(JSON.stringify({ action: "place_bet", item: item }));
            tg.close();
        }

        function requestTopUp() {
            tg.HapticFeedback.notificationOccurred('success');
            tg.sendData(JSON.stringify({ action: "top_up_request" }));
            tg.close();
        }

        function nav(viewId, btnId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            document.getElementById(btnId).classList.add('active');
        }

        // --- TIMER LOGIC ---
        let [m, s] = timerStart.split(':').map(Number);
        setInterval(() => {
            if (s > 0) s--;
            else if (m > 0) { m--; s = 59; }
            document.getElementById('timerVal').innerText = `${m}:${s < 10 ? '0'+s : s}`;
        }, 1000);
    </script>
</body>
</html>
